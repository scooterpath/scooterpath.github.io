<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="./js/main.js"></script>
    <title>Scooter Path Survey</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-bar">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
        <button id="logoutBtn" style="display: none;">Logout</button>
        <span id="userStatus"></span>
      </div>
      
    <div class="tour">
        <div class="container">
            <div class="tour__head">
                <h2 id="question-title">Question</h2>
            </div>
            <div class="infospot-toggle">
                <label for="toggle-infospot">
                  <input type="checkbox" id="toggle-infospot">
                  Enable Infospot Addition
                </label>
              </div>
              
            
            <div class="image-container" id="image-container"></div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button id="prev-btn" onclick="navigateToPreviousPage()">Previous</button>
                <button id="next-btn" onclick="navigateToNextPage()">Next</button>
                <button id="save" onclick="submitInfospotsToSupabase()">Save</button>
            </div>
        </div>
    </div>

    <input type="email" id="userEmail" placeholder="Enter your email" required readonly>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlaGNhcXNhbW1xZG15cG5mcmtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkzOTYwNjgsImV4cCI6MjA1NDk3MjA2OH0.zvRddX9uDnu3RA0jwK4Mg4baRoIcRZ-tDIIdmEPdcmg";

        const supabase = createClient(
          "https://kehcaqsammqdmypnfrke.supabase.co",
          SUPABASE_ANON_KEY 
        );
        window.supabase = supabase;
      
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const loginBtn = document.getElementById("loginBtn");
        const signupBtn = document.getElementById("signupBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const userStatus = document.getElementById("userStatus");
      
        async function updateAuthUI() {
          const { data: { user } } = await supabase.auth.getUser();
          if (user) {
            emailInput.style.display = "none";
            passwordInput.style.display = "none";
            loginBtn.style.display = "none";
            signupBtn.style.display = "none";
            logoutBtn.style.display = "inline-block";
            userStatus.textContent = `Logged in as: ${user.email}`;
            localStorage.setItem("userEmail", user.email);
            localStorage.setItem("userUUID", user.id);
            document.getElementById("userEmail").value = user.email;
          } else {
            emailInput.style.display = "inline-block";
            passwordInput.style.display = "inline-block";
            loginBtn.style.display = "inline-block";
            signupBtn.style.display = "inline-block";
            logoutBtn.style.display = "none";
            userStatus.textContent = "";
            localStorage.removeItem("userEmail");
            localStorage.removeItem("userUUID");
          }
        }
      
        async function login() {
          const { error } = await supabase.auth.signInWithPassword({
            email: emailInput.value,
            password: passwordInput.value
          });
          if (error) alert("Login failed: " + error.message);
          else {
            alert("Login successful!");
            updateAuthUI();
          }
        }
      
        async function signup() {
          const { error } = await supabase.auth.signUp({
            email: emailInput.value,
            password: passwordInput.value
          });
          if (error) alert("Signup failed: " + error.message);
          else {
            alert("Signup successful! Please check your email.");
            updateAuthUI();
          }
        }
      
        async function logout() {
          await supabase.auth.signOut();
          alert("Logged out!");
          updateAuthUI();
        }
      
        loginBtn.addEventListener("click", login);
        signupBtn.addEventListener("click", signup);
        logoutBtn.addEventListener("click", logout);
      
        updateAuthUI();
      </script>
      
    <script>
        // Get the current page number from URL or default to 1
        const currentPage = parseInt(new URLSearchParams(window.location.search).get('page') || '1');
        function generateImageNames(baseName, startIndex, endIndex, extension) {
            const images = [];
            for (let i = startIndex; i <= endIndex; i++) {
                images.push(`${baseName}${i}.${extension}`);
            }
            return images.join(','); // Convert the array to a comma-separated string
        }
        // Define questions for each page
        const questions = [
            {
                name: "Boulevard",
                images: generateImageNames('blvd',0,19,'jpg'),
                path: 'images/blvd/',
            },
            {
                name: "Asylum",
                images: generateImageNames('asylum',0,19,'jpg'),
                path: 'images/asylum/',
            },
            {
                name: "Brookfield",
                images: generateImageNames('brookfield',0,19,'jpg'),
                path: 'images/brookfield/'
            },
            {
                name: "Canal Road",
                images: generateImageNames('canalroad',0,21,'jpg'),
                path: 'images/canalroad/'
            },
            {
                name: "Capitol",
                images: generateImageNames('capitol',0,19,'jpg'),
                path: 'images/capitol/'
            },
            {
                name: "Farmington",
                images: generateImageNames('farmington',0,11,'jpg'),
                path: 'images/farmington/'
            },
            {
                name: "Fern",
                images: generateImageNames('fern',0,21,'jpg'),
                path: 'images/fern/'
            },
            {
                name: "King Philip",
                images: generateImageNames('kingphilip',0,13,'jpg'),
                path: 'images/kingphilip/'
            },
            {
                name: "Church",
                images: generateImageNames('church',0,19,'jpg'),
                path: 'images/church/'
            },
            {
                name: "Mountain",
                images: generateImageNames('mountain',0,21,'jpg'),
                path: 'images/mountain/'
            },
            {
                name: "Oakwood",
                images: generateImageNames('oakwood',0,8,'jpg'),
                path: 'images/oakwood/'
            },
            {
                name: "Park",
                images: generateImageNames('park',0,19,'jpg'),
                path: 'images/park/'
            },
            {
                name: "Ridgewood",
                images: generateImageNames('ridgewood',0,15,'jpg'),
                path: 'images/ridgewood/'
            },
            {
                name: "Tunxis",
                images: generateImageNames('tunxis',0,14,'jpg'),
                path: 'images/tunxis/'
            },
            {
                name: "West Boulevard",
                images: generateImageNames('westblvd',0,19,'jpg'),
                path: 'images/westblvd/'
            }
            // Add more questions here
        ];

        // Set the title and image container based on the current page
        //document.getElementById('question-title').textContent = questions[currentPage - 1].title;
        document.getElementById('question-title').textContent = `Question ${currentPage} / ${questions.length}: ${questions[currentPage - 1].name}`;
        document.getElementById('image-container').setAttribute('data-images', questions[currentPage - 1].images);
        document.getElementById('image-container').setAttribute('data-path', questions[currentPage - 1].path);

        // Prefill saved answers if available in localStorage
        window.onload = function() {
            const savedEmail = localStorage.getItem('userEmail');
            if (savedEmail) {
                document.getElementById('userEmail').value = savedEmail; // Populate email field
            } else {
                alert('Please enter your email on the first page');
                location.href = 'index.html'; // Redirect to the first page if email is missing
            }
        };
        async function submitInfospotsToSupabase() {
            if (typeof window.submitInfospotsToSupabase === "function") {
                await window.submitInfospotsToSupabase();
            } else {
                console.warn("submitInfospotsToSupabase not found.");
            }
        }

        // Navigate to the next page
        async function navigateToNextPage() {
            await submitInfospotsToSupabase();
            // Proceed to the next page
            if (currentPage < questions.length) {
                location.href = `survey.html?page=${currentPage + 1}`;
            } else {
                location.href = 'final.html'; // Redirect to the final page if it's the last question
            }
        }

        // Navigate to the previous page
        function navigateToPreviousPage() {
            if (currentPage > 1) {
                location.href = `survey.html?page=${currentPage - 1}`;
            } else {
                location.href = 'index.html'; // Redirect to the first page if it's the first question
            }
        }

    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/105/three.min.js"></script>
    <script src="./js/panolens.min.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>
